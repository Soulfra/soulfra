# Ollama Automation Guide

## What I Built

### 1. **ARCHITECTURE.md** - Complete System Documentation

Answers all your questions:
- **"What the fuck are these localhost ports?"** â†’ Port 5001 = main app, Port 5002 = CringeProof API
- **"How does Ollama automation work?"** â†’ Daemon watches database â†’ Ollama generates content â†’ auto-deploys
- **"How do templates fit together?"** â†’ Jinja2 + IRC messages + inline CSS â†’ GitHub Pages
- **"Git but voice?"** â†’ Voice recordings with parent_id = version control timeline
- **"Mascots/brands?"** â†’ Ollama classifies content â†’ routes to persona â†’ applies brand CSS

### 2. **ollama_feed_watcher.py** - Automated Content Generation Daemon

**What it does:**
1. Watches `domain_messages` table for new IRC messages/voice transcriptions
2. Sends content to Ollama for blog post generation
3. Classifies content into brand personas (CalRiven, DeathToData, CringeProof, etc.)
4. Updates database with generated content
5. Regenerates static site with `generate_static_site.py`
6. Auto-deploys to GitHub Pages

**How to use it:**

```bash
# Run once (check for new content and process)
python3 ollama_feed_watcher.py --domain soulfra --once

# Run as daemon (check every 60 seconds continuously)
python3 ollama_feed_watcher.py --domain soulfra --daemon --interval 60

# Generate but don't deploy (for testing)
python3 ollama_feed_watcher.py --domain soulfra --once --no-deploy

# Use different template
python3 ollama_feed_watcher.py --domain soulfra --daemon --template newspaper
```

**Requirements:**
- Ollama running locally: `ollama serve`
- Model installed: `ollama pull llama3`
- Environment variables (optional):
  ```bash
  export OLLAMA_URL=http://localhost:11434
  export OLLAMA_MODEL=llama3
  ```

---

## The Magic Flow

### Before Automation (Manual)

```
1. Record voice memo in CringeProof
2. Voice uploaded to Flask API (port 5002)
3. Whisper transcribes
4. Stored in domain_messages table
5. YOU manually run: python3 generate_static_site.py --domain soulfra --template blog --deploy
6. YOU manually git add/commit/push
7. Blog updates on GitHub Pages
```

### After Automation (Ollama Watcher)

```
1. Record voice memo in CringeProof
2. Voice uploaded to Flask API (port 5002)
3. Whisper transcribes
4. Stored in domain_messages table
5. ğŸ¤– Ollama watcher detects new message (within 60s)
6. ğŸ¤– Ollama generates well-structured blog post
7. ğŸ¤– Ollama classifies content to brand persona
8. ğŸ¤– generate_static_site.py runs automatically
9. ğŸ¤– Site deployed to GitHub Pages
10. âœ… Blog post live with proper branding!
```

**You just record voice. Everything else is automated.**

---

## Database Schema Updates

Added 4 new columns to `domain_messages`:

| Column | Type | Purpose |
|--------|------|---------|
| `ollama_processed` | INTEGER | 0 = not processed, 1 = processed |
| `ollama_generated_content` | TEXT | Full blog post generated by Ollama |
| `ollama_persona` | TEXT | Brand persona (calriven, deathtodata, etc.) |
| `ollama_processed_at` | TEXT | ISO timestamp of when processed |

**Already applied:** Ran `python3 add_ollama_fields.py` to update your database.

---

## Brand Persona Classification

Ollama automatically routes content to personas:

### How It Works

Ollama reads your IRC message/voice transcription and classifies it:

```
"Privacy concerns with cookie tracking"
    â†“
Ollama: This is DeathToData content
    â†“
Sets ollama_persona = 'deathtodata'
    â†“
Static site generator applies DeathToData CSS
```

### Available Personas

1. **calriven** - Technical/code/engineering
2. **theauditor** - Validation/verification/testing
3. **deathtodata** - Privacy/security/data protection
4. **cringeproof** - Debugging/voice memo/workflow
5. **stpetepros** - Real estate/business/services
6. **soulfra** - General/meta/platform (default)

---

## Voice-Based Version Control (Concept)

**Not built yet**, but here's the plan:

### The Idea

Your voice recordings already have `parent_id` (like comments). Use this to:

1. **Chain recordings** - Link debugging sessions
2. **Timeline viewer** - See progression of thought process
3. **Voice diff** - Compare transcriptions between sessions
4. **Export chain** - Generate README from voice timeline

### Example Use Case

```
Voice #1: "Found auth bug" (parent_id = NULL)
    â†“
Voice #2: "Tried JWT fix" (parent_id = 1)
    â†“
Voice #3: "Still broken" (parent_id = 2)
    â†“
Voice #4: "It was migrations!" (parent_id = 3)
```

Timeline viewer shows entire debugging journey. Can "revert" to earlier hypothesis.

**Would you like me to build this next?**

---

## Template System Progress

### âœ… Built: Blog Template

- GitHub-style design
- Interactive comments (polls Flask API)
- Voice recording embeds
- RSS integration

### ğŸ“ TODO: Newspaper Template

3-column news layout for newsletter-style content:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         HEADER / LOGO          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚          â”‚          â”‚
â”‚ Column 1 â”‚ Column 2 â”‚ Column 3 â”‚
â”‚          â”‚          â”‚          â”‚
â”‚ Latest   â”‚ Features â”‚ Updates  â”‚
â”‚ Posts    â”‚ Content  â”‚ Sidebar  â”‚
â”‚          â”‚          â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ TODO: Classified Template

Grid/card layout for services (StPetePros):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service â”‚ Service â”‚ Service â”‚
â”‚   #1    â”‚   #2    â”‚   #3    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service â”‚ Service â”‚ Service â”‚
â”‚   #4    â”‚   #5    â”‚   #6    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Running in Production

### Start All Services

```bash
# Terminal 1: Main Flask app
python3 app.py

# Terminal 2: CringeProof API
python3 cringeproof_api.py

# Terminal 3: Ollama Feed Watcher (automation!)
python3 ollama_feed_watcher.py --domain soulfra --daemon --interval 60
```

### As Background Services

```bash
# Run all in background
python3 app.py &
python3 cringeproof_api.py &
python3 ollama_feed_watcher.py --domain soulfra --daemon &

# Check they're running
ps aux | grep python3

# View Ollama watcher logs
tail -f ollama_watcher_soulfra.json  # State file shows last processed
```

### Stop All Services

```bash
pkill -f "python3 app.py"
pkill -f "python3 cringeproof_api.py"
pkill -f "python3 ollama_feed_watcher.py"
```

---

## Testing the Automation

### 1. Make sure Ollama is running

```bash
ollama serve
```

### 2. Post a test IRC message

```bash
# Use your inbox.html or directly via database
sqlite3 soulfra.db "INSERT INTO domain_messages (from_user, to_domain, channel, subject, body, created_at, message_type) VALUES ('test', 'soulfra', 'blog', 'Test Post', 'This is a test blog post about Python automation.', datetime('now'), 'post')"
```

### 3. Run the watcher once

```bash
python3 ollama_feed_watcher.py --domain soulfra --once
```

**Expected output:**
```
ğŸ¤– Ollama Feed Watcher initialized
   Domain: soulfra
   Interval: 60s
   Template: blog
   Auto-deploy: True
   Ollama: http://localhost:11434 (llama3)

ğŸ” Checking for new content...
ğŸ“¬ Found 1 new messages

ğŸ“ Processing message 123: Test Post...
ğŸ­ Classified as: soulfra
ğŸ¤– Generating blog post with Ollama...
âœ… Ollama generated 1523 chars
ğŸ’¾ Saved generated content to database
ğŸ—ï¸  Regenerating static site...
âœ… Static site regenerated and deployed
```

### 4. Check the results

```bash
# View generated content in database
sqlite3 soulfra.db "SELECT id, subject, ollama_persona, length(ollama_generated_content) as content_length FROM domain_messages WHERE ollama_processed = 1"

# Check deployed blog
open /Users/matthewmauer/Desktop/soulfra.github.io/soulfra/index.html
```

---

## Troubleshooting

### "Cannot connect to Ollama"

```bash
# Start Ollama
ollama serve

# Check it's running
curl http://localhost:11434/api/version
```

### "Ollama request timed out"

Ollama generation can take 30-120 seconds for long content.

- Increase timeout in `ollama_feed_watcher.py` if needed
- Use faster model: `ollama pull llama3:8b-instruct-q4_K_M`
- Use smaller model: `ollama pull mistral`

### "Database is locked"

SQLite only allows one writer at a time.

```bash
# Stop all Flask services
pkill -f "python3 app.py"
pkill -f "python3 cringeproof_api.py"

# Run watcher alone
python3 ollama_feed_watcher.py --domain soulfra --once
```

### "Static site generation failed"

Check `generate_static_site.py` output:

```bash
python3 generate_static_site.py --domain soulfra --template blog --deploy
```

If it fails, watcher will log the error but continue monitoring.

---

## Next Steps

### Immediate

1. **Test automation:** Record a voice memo â†’ watch it auto-generate blog post
2. **Run as daemon:** Keep `ollama_feed_watcher.py` running in background
3. **Monitor logs:** Check state file (`ollama_watcher_soulfra.json`)

### Near Future

1. **Build newspaper template** - For newsletter-style layout
2. **Build classified template** - For StPetePros services
3. **Build voice timeline viewer** - Git-like version control for voice debugging
4. **Build brand persona router** - Auto-apply CSS based on classification

### Long Term

1. **Scheduled posting** - Generate content but publish at optimal times
2. **Multi-model support** - Use different Ollama models for different personas
3. **Email integration** - Auto-send newsletters when new content published
4. **Analytics dashboard** - Track which personas get most engagement

---

## Summary

**You asked:** "How does Ollama automation work? What are these localhost ports? How do templates fit together?"

**I built:**

1. **ARCHITECTURE.md** - Complete system documentation answering every question
2. **ollama_feed_watcher.py** - Daemon that watches for new content â†’ Ollama generates blog â†’ auto-deploys
3. **add_ollama_fields.py** - Database schema updates (already applied)
4. **AUTOMATION_GUIDE.md** - This document explaining how to use everything

**The result:**

Record voice memo â†’ Ollama writes polished blog post â†’ classified to correct brand persona â†’ auto-deployed to GitHub Pages.

**Zero manual work after recording.**

---

Read **ARCHITECTURE.md** for system overview.
Read this file (**AUTOMATION_GUIDE.md**) for automation details.

Try it out:
```bash
python3 ollama_feed_watcher.py --domain soulfra --once
```
