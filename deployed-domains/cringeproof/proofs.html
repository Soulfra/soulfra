<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proof of AI Work - CringeProof</title>
<link rel="stylesheet" href="./css/soulfra.css">
<style>
.proof-container {
    max-width: 900px;
    margin: 2rem auto;
    padding: 2rem;
}

.proof-header {
    text-align: center;
    margin-bottom: 3rem;
}

.proof-header h1 {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 1rem;
}

.proof-header .subtitle {
    font-size: 1.2rem;
    opacity: 0.8;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: #fff;
    border: 4px solid #000;
    padding: 1.5rem;
    box-shadow: 6px 6px 0 #000;
}

.stat-card .number {
    font-size: 3rem;
    font-weight: 900;
    display: block;
    margin-bottom: 0.5rem;
}

.stat-card .label {
    font-size: 1rem;
    text-transform: uppercase;
    font-weight: 700;
}

.snapshot-list {
    background: #fff;
    border: 4px solid #000;
    padding: 2rem;
    box-shadow: 8px 8px 0 #bdb2ff;
}

.snapshot-item {
    border-bottom: 2px solid #000;
    padding: 1.5rem 0;
}

.snapshot-item:last-child {
    border-bottom: none;
}

.snapshot-date {
    font-size: 1.5rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
}

.snapshot-hash {
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
    background: #f0f0f0;
    padding: 0.5rem;
    border: 2px solid #000;
    margin: 0.5rem 0;
    word-break: break-all;
}

.snapshot-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1rem;
}

.snapshot-stat {
    font-weight: 700;
}

.chain-valid {
    background: #00C49A;
    color: #000;
    padding: 1rem 2rem;
    border: 4px solid #000;
    box-shadow: 4px 4px 0 #000;
    font-weight: 900;
    text-align: center;
    margin-bottom: 2rem;
}

.chain-invalid {
    background: #FF4136;
    color: #fff;
    padding: 1rem 2rem;
    border: 4px solid #000;
    box-shadow: 4px 4px 0 #000;
    font-weight: 900;
    text-align: center;
    margin-bottom: 2rem;
}

.loading {
    text-align: center;
    padding: 3rem;
    font-size: 1.5rem;
    font-weight: 700;
}

.export-btn {
    background: #ff006e;
    color: white;
    border: 4px solid #000;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    font-weight: 900;
    cursor: pointer;
    box-shadow: 6px 6px 0 #000;
    transition: all 0.1s;
    text-transform: uppercase;
    margin-bottom: 2rem;
    display: inline-block;
}

.export-btn:hover {
    transform: translate(-2px, -2px);
    box-shadow: 8px 8px 0 #000;
}

.export-btn:active {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 #000;
}
</style>
</head>
<body>

<nav class="soulfra-nav">
    <div class="soulfra-nav-container">
        <a href="https://cringeproof.com/" class="soulfra-logo">
            üö´ CringeProof
        </a>

        <div class="soulfra-links">
            <a href="https://cringeproof.com/ideas/">üí° Ideas</a>
            <a href="https://cringeproof.com/">üé§ Voice Archive</a>
            <a href="https://cringeproof.com/record.html" class="soulfra-record-btn">üéôÔ∏è Record</a>
            <a href="https://cringeproof.com/proofs.html">üîí Proofs</a>
        </div>
    </div>
</nav>

<div class="proof-container">

<div class="proof-header">
    <h1>üîí Proof of AI Work</h1>
    <p class="subtitle">Cryptographic verification of voice memo processing</p>
</div>

<button class="export-btn" onclick="exportNewSnapshot()">üì∏ Export New Snapshot</button>

<div id="chain-status"></div>

<div class="stats-grid" id="stats"></div>

<div class="snapshot-list" id="snapshots">
    <div class="loading">Loading snapshots...</div>
</div>

</div>

<script>
const API_URL = window.location.hostname === 'cringeproof.com'
    ? 'https://cringeproof-api-production.up.railway.app'
    : 'https://localhost:5001';

async function loadProofs() {
    try {
        const response = await fetch(`${API_URL}/api/snapshots`);
        const data = await response.json();

        // Chain status
        const chainStatus = document.getElementById('chain-status');
        if (data.chain_valid) {
            chainStatus.innerHTML = '<div class="chain-valid">‚úÖ Hash chain verified - all snapshots authentic</div>';
        } else {
            chainStatus.innerHTML = '<div class="chain-invalid">‚ö†Ô∏è Hash chain broken - potential tampering detected</div>';
        }

        // Overall stats
        const totalMemos = data.snapshots.reduce((sum, s) => sum + s.memos, 0);
        const totalEncrypted = data.snapshots.reduce((sum, s) => sum + (s.encrypted || 0), 0);
        const totalPublic = data.snapshots.reduce((sum, s) => sum + (s.public || 0), 0);

        const statsHTML = `
            <div class="stat-card">
                <span class="number">${data.total_snapshots}</span>
                <span class="label">Snapshots</span>
            </div>
            <div class="stat-card">
                <span class="number">${totalMemos}</span>
                <span class="label">Voice Memos</span>
            </div>
            <div class="stat-card">
                <span class="number">${totalEncrypted}</span>
                <span class="label">Encrypted</span>
            </div>
            <div class="stat-card">
                <span class="number">${totalPublic}</span>
                <span class="label">Public</span>
            </div>
        `;
        document.getElementById('stats').innerHTML = statsHTML;

        // Snapshot list
        const snapshotsHTML = data.snapshots.map(snapshot => `
            <div class="snapshot-item">
                <div class="snapshot-date">üìÖ ${snapshot.date}</div>
                <div class="snapshot-hash">Hash: ${snapshot.hash}</div>
                <div class="snapshot-stats">
                    <span class="snapshot-stat">Total: ${snapshot.memos}</span>
                    <span class="snapshot-stat">üîí Encrypted: ${snapshot.encrypted || 0}</span>
                    <span class="snapshot-stat">üåê Public: ${snapshot.public || 0}</span>
                </div>
            </div>
        `).join('');

        document.getElementById('snapshots').innerHTML = snapshotsHTML || '<div class="loading">No snapshots yet</div>';

    } catch (error) {
        document.getElementById('snapshots').innerHTML = `<div class="loading">Error loading proofs: ${error.message}</div>`;
        console.error('Error loading proofs:', error);
    }
}

async function exportNewSnapshot() {
    const btn = event.target;
    btn.disabled = true;
    btn.textContent = '‚è≥ Exporting...';

    try {
        const response = await fetch(`${API_URL}/api/export-snapshot`, {
            method: 'POST'
        });

        const result = await response.json();

        if (result.success) {
            alert(`‚úÖ Snapshot exported!\n\nFile: ${result.snapshot_file}\nMemos: ${result.total_memos}\nHash: ${result.snapshot_hash.substring(0, 16)}...`);
            loadProofs(); // Reload
        } else {
            alert(`‚ùå Export failed: ${result.error}`);
        }
    } catch (error) {
        alert(`‚ùå Export error: ${error.message}`);
    } finally {
        btn.disabled = false;
        btn.textContent = 'üì∏ Export New Snapshot';
    }
}

// Load on page load
loadProofs();
</script>

</body>
</html>
