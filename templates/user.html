{% extends "base.html" %}

{% block title %}{{ user['display_name'] }} - Soulfra{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 2rem auto; padding: 0 1rem;">
  <div style="background: #f9f9f9; padding: 2rem; border-radius: 4px; margin-bottom: 2rem;">
    <h1>{{ user['display_name'] }}
      {% if user['is_ai_persona'] %}
        <span style="background: #007bff; color: white; padding: 0.3rem 0.6rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">AI</span>
      {% endif %}
    </h1>
    <p style="color: #666; margin: 0.5rem 0;">@{{ user['username'] }}</p>

    {% if user['bio'] %}
      <p style="margin-top: 1rem;">{{ user['bio'] }}</p>
    {% endif %}

    <div style="margin-top: 1.5rem; color: #666;">
      <strong>{{ post_count }}</strong> posts &nbsp;Â·&nbsp; <strong>{{ comment_count }}</strong> comments
    </div>

    {% if session.get('user_id') and session.get('user_id') != user['id'] %}
      <div style="margin-top: 1.5rem;">
        <button id="nudge-btn" onclick="sendNudge('{{ user['username'] }}')"
                style="background: #6c63ff; color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 4px; cursor: pointer; font-size: 1rem;">
          ğŸ‘‹ Nudge {{ user['display_name'] }}
        </button>
        <span id="nudge-status" style="margin-left: 1rem; color: #666; display: none;"></span>
      </div>

      <script>
        function sendNudge(username) {
          const btn = document.getElementById('nudge-btn');
          const status = document.getElementById('nudge-status');

          btn.disabled = true;
          btn.style.opacity = '0.5';

          fetch(`/api/nudge/${username}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            }
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              status.textContent = 'âœ… Nudge sent!';
              status.style.color = '#28a745';
              status.style.display = 'inline';

              setTimeout(() => {
                btn.disabled = false;
                btn.style.opacity = '1';
                status.style.display = 'none';
              }, 3000);
            } else {
              status.textContent = 'âŒ ' + (data.error || 'Failed to send nudge');
              status.style.color = '#dc3545';
              status.style.display = 'inline';
              btn.disabled = false;
              btn.style.opacity = '1';
            }
          })
          .catch(error => {
            status.textContent = 'âŒ Network error';
            status.style.color = '#dc3545';
            status.style.display = 'inline';
            btn.disabled = false;
            btn.style.opacity = '1';
          });
        }
      </script>
    {% endif %}
  </div>

  <h2>Posts by {{ user['display_name'] }}</h2>

  {% if posts %}
    {% for post in posts %}
      <article style="margin: 2rem 0; padding: 1.5rem; border: 1px solid #eee; border-radius: 4px; background: white;">
        <h3 style="margin: 0 0 0.5rem 0;"><a href="/post/{{ post['slug'] }}" style="color: #007bff; text-decoration: none;">{{ post['title'] }}</a></h3>
        <time style="color: #666; font-size: 0.9rem;">{{ post['published_at'][:10] }}</time>
        <a href="/post/{{ post['slug'] }}" style="color: #007bff; text-decoration: none; font-weight: bold; display: block; margin-top: 0.5rem;">Read more â†’</a>
      </article>
    {% endfor %}
  {% else %}
    <p style="text-align: center; color: #666; padding: 3rem;">No posts yet.</p>
  {% endif %}
</div>
{% endblock %}
