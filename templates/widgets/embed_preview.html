{% extends "base.html" %}

{% block title %}Widget Embed Preview{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Chat Widget - Embed Preview</h1>

        <!-- Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
            <h2 class="text-lg font-semibold text-blue-900 mb-2">
                <svg class="inline-block w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                How to Embed
            </h2>
            <p class="text-blue-800 mb-4">Copy and paste this code into your website:</p>

            <div class="bg-white rounded-lg p-4 border border-blue-300">
                <pre class="text-xs font-mono overflow-x-auto"><code id="embed-code">{{ embed_code }}</code></pre>
                <button onclick="copyEmbedCode()" class="mt-3 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition text-sm">
                    <svg class="inline-block w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                    </svg>
                    Copy Code
                </button>
            </div>
        </div>

        <!-- Live Preview -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Live Preview</h2>

            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 min-h-[400px] relative bg-gray-50">
                <div class="absolute top-2 right-2 text-xs text-gray-500 bg-white px-2 py-1 rounded">
                    Preview Mode
                </div>

                <!-- Widget will appear here -->
                <div id="widget-preview-container">
                    <!-- Widget loads here -->
                </div>
            </div>
        </div>

        <!-- Configuration Options -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Widget Configuration</h2>

            <form id="widget-config-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Target URL</label>
                    <input type="text" name="target_url" value="{{ target_url or '/user/demo' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Widget Title</label>
                    <input type="text" name="widget_title" value="{{ widget_title or 'Chat with us' }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Primary Color</label>
                    <input type="color" name="primary_color" value="{{ primary_color or '#667eea' }}"
                           class="w-20 h-10 border border-gray-300 rounded cursor-pointer">
                </div>

                <div class="flex items-center space-x-2">
                    <input type="checkbox" name="show_qr" id="show_qr"
                           {% if show_qr %}checked{% endif %}
                           class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="show_qr" class="text-sm font-medium text-gray-700">Show QR Code</label>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                    <select name="position" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="bottom-right">Bottom Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="top-left">Top Left</option>
                    </select>
                </div>

                <button type="button" onclick="updateWidget()"
                        class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                    Update Preview
                </button>
            </form>
        </div>

        <!-- Platforms -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Integration Guides</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <a href="#wordpress" class="block p-4 border border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition">
                    <div class="text-lg font-semibold text-gray-900 mb-1">WordPress</div>
                    <div class="text-sm text-gray-600">Add to theme or use plugin</div>
                </a>

                <a href="#shopify" class="block p-4 border border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition">
                    <div class="text-lg font-semibold text-gray-900 mb-1">Shopify</div>
                    <div class="text-sm text-gray-600">Theme customization</div>
                </a>

                <a href="#custom" class="block p-4 border border-gray-200 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition">
                    <div class="text-lg font-semibold text-gray-900 mb-1">Custom HTML</div>
                    <div class="text-sm text-gray-600">Any website</div>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyEmbedCode() {
    const code = document.getElementById('embed-code').textContent;
    navigator.clipboard.writeText(code).then(() => {
        alert('Embed code copied to clipboard!');
    });
}

function updateWidget() {
    const form = document.getElementById('widget-config-form');
    const formData = new FormData(form);

    // Build config from form
    const config = {
        target_url: formData.get('target_url'),
        widget_title: formData.get('widget_title'),
        primary_color: formData.get('primary_color'),
        show_qr: formData.get('show_qr') === 'on',
        position: formData.get('position')
    };

    // Fetch new embed code
    const params = new URLSearchParams(config);
    fetch(`/api/widget/embed?${params}`)
        .then(res => res.json())
        .then(data => {
            // Update embed code display
            document.getElementById('embed-code').textContent = data.embed_code;

            // Reload preview
            // (Would need actual widget JavaScript to work)
            console.log('Widget config updated:', config);
        });
}

// Load widget preview on page load
document.addEventListener('DOMContentLoaded', function() {
    // Widget preview initialization
    console.log('Widget preview ready');
});
</script>
{% endblock %}
