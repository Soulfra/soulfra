<!-- QR Code Display Component -->
<div class="qr-display-component text-center">
    {% if qr_image %}
        <!-- Image QR Code -->
        <div class="inline-block p-4 bg-white border-2 border-gray-200 rounded-lg">
            <img src="{{ qr_image }}" alt="QR Code" class="w-48 h-48 mx-auto" />
        </div>

        {% if qr_url %}
        <div class="mt-3 text-sm text-gray-600">
            <a href="{{ qr_url }}" class="text-indigo-600 hover:text-indigo-800 font-mono text-xs break-all">
                {{ qr_url }}
            </a>
        </div>
        {% endif %}

    {% elif qr_ascii %}
        <!-- ASCII QR Code (for terminal) -->
        <div class="bg-black text-white p-4 rounded-lg font-mono text-xs overflow-x-auto">
            <pre>{{ qr_ascii }}</pre>
        </div>
        <div class="mt-2 text-xs text-gray-500">
            ASCII QR Code - Scan from terminal or save as image
        </div>

    {% elif qr_url %}
        <!-- QR Code URL provided - generate client-side -->
        <div id="qr-code-container" class="inline-block p-4 bg-white border-2 border-gray-200 rounded-lg">
            <!-- QR code will be generated here by JavaScript -->
        </div>
        <div class="mt-3 text-sm text-gray-600">
            <a href="{{ qr_url }}" class="text-indigo-600 hover:text-indigo-800 font-mono text-xs break-all">
                {{ qr_url }}
            </a>
        </div>

        <script>
        // Generate QR code client-side using qrcode.js library
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('qr-code-container');
            if (container && typeof QRCode !== 'undefined') {
                new QRCode(container, {
                    text: "{{ qr_url }}",
                    width: 192,
                    height: 192,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.M
                });
            }
        });
        </script>

    {% else %}
        <!-- No QR code data provided -->
        <div class="text-center py-8 text-gray-500">
            <svg class="w-16 h-16 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
            </svg>
            <p>QR code not available</p>
        </div>
    {% endif %}

    <!-- Download button -->
    {% if qr_image or qr_url %}
    <div class="mt-4">
        <button onclick="downloadQR()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition text-sm">
            <svg class="inline-block w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Download QR Code
        </button>
    </div>

    <script>
    function downloadQR() {
        {% if qr_image %}
        // Download base64 image
        const link = document.createElement('a');
        link.href = "{{ qr_image }}";
        link.download = 'qr-code.png';
        link.click();
        {% else %}
        // Download generated QR code
        const canvas = document.querySelector('#qr-code-container canvas');
        if (canvas) {
            const link = document.createElement('a');
            link.href = canvas.toDataURL('image/png');
            link.download = 'qr-code.png';
            link.click();
        }
        {% endif %}
    }
    </script>
    {% endif %}
</div>

<style>
.qr-display-component img {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.qr-display-component pre {
    line-height: 1;
    letter-spacing: 0;
}
</style>
