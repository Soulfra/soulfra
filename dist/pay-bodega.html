<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay via Bodega Receipt - StPetePros</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', 'OCR-B', monospace;
            background: #f5f5f5;
            color: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Barcode background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(
                90deg,
                #000 0px,
                #000 2px,
                transparent 2px,
                transparent 4px,
                #000 4px,
                #000 5px,
                transparent 5px,
                transparent 10px,
                #000 10px,
                #000 12px,
                transparent 12px,
                transparent 15px
            );
            opacity: 0.05;
            z-index: 0;
        }

        /* Receipt container */
        .receipt-container {
            position: relative;
            z-index: 1;
            max-width: 500px;
            width: 100%;
            background: #fff;
            border: 2px dashed #000;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Perforated edge effect */
        .receipt-container::before,
        .receipt-container::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 10px;
            background-image: radial-gradient(circle, transparent 40%, #fff 40%);
            background-size: 20px 20px;
            background-position: 0 0;
        }

        .receipt-container::before {
            top: -5px;
        }

        .receipt-container::after {
            bottom: -5px;
        }

        /* Header */
        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #000;
        }

        .receipt-header h1 {
            font-size: 1.8em;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .receipt-header .status {
            margin-top: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        /* Barcode separator */
        .barcode-separator {
            height: 50px;
            margin: 20px 0;
            background-image: repeating-linear-gradient(
                90deg,
                #000 0px,
                #000 2px,
                #fff 2px,
                #fff 4px,
                #000 4px,
                #000 6px,
                #fff 6px,
                #fff 8px,
                #000 8px,
                #000 10px,
                #fff 10px,
                #fff 14px,
                #000 14px,
                #000 16px,
                #fff 16px,
                #fff 18px
            );
            background-size: 18px 100%;
        }

        /* Transaction Details */
        .transaction-details {
            margin: 20px 0;
        }

        .transaction-details h2 {
            margin-bottom: 10px;
            font-size: 1.2em;
            text-align: center;
            letter-spacing: 1px;
            border-bottom: 1px solid #000;
            padding-bottom: 5px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.9em;
        }

        .detail-row:nth-child(even) {
            background: #f9f9f9;
        }

        .detail-label {
            text-transform: uppercase;
            font-size: 0.85em;
        }

        .detail-value {
            font-weight: bold;
            text-align: right;
        }

        /* Total amount highlight */
        .detail-row.total {
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            margin-top: 10px;
            padding: 12px 0;
            font-size: 1.1em;
        }

        /* Payment section */
        .payment-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border: 2px dashed #000;
            text-align: center;
        }

        .payment-section h2 {
            margin-bottom: 15px;
            font-size: 1.2em;
            letter-spacing: 1px;
        }

        /* Stripe iframe container */
        .stripe-container {
            margin: 15px 0;
            background: #fff;
            border: 2px solid #000;
            padding: 10px;
            min-height: 300px;
        }

        .stripe-container iframe {
            width: 100%;
            min-height: 400px;
            border: none;
        }

        /* Payment instructions */
        .payment-instructions {
            font-size: 0.85em;
            margin-top: 15px;
            padding: 10px;
            background: #fff;
            border: 1px dashed #000;
        }

        .payment-instructions p {
            margin: 5px 0;
        }

        /* Receipt number */
        .receipt-number {
            text-align: center;
            font-size: 1.2em;
            letter-spacing: 3px;
            margin: 15px 0;
            padding: 8px;
            background: #000;
            color: #fff;
        }

        /* Footer */
        .receipt-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px dashed #000;
            font-size: 0.8em;
        }

        .receipt-footer p {
            margin: 5px 0;
        }

        /* PAID stamp */
        .paid-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 4em;
            font-weight: bold;
            color: rgba(0, 128, 0, 0.3);
            border: 8px solid rgba(0, 128, 0, 0.3);
            padding: 20px 40px;
            letter-spacing: 10px;
            display: none;
            pointer-events: none;
            z-index: 10;
        }

        .paid-stamp.show {
            display: block;
        }

        /* Loading state */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }

        /* Alternative payment methods */
        .alt-payment {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border: 1px solid #000;
        }

        .alt-payment h3 {
            font-size: 1em;
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
        }

        .payment-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #000;
            color: #fff;
            border: 2px solid #000;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-decoration: none;
            text-align: center;
        }

        .payment-button:hover {
            background: #fff;
            color: #000;
        }

        .payment-button.venmo {
            background: #3D95CE;
            border-color: #3D95CE;
        }

        .payment-button.cashapp {
            background: #00D632;
            border-color: #00D632;
        }

        .payment-button.paypal {
            background: #0070BA;
            border-color: #0070BA;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .receipt-container {
                padding: 20px;
            }

            .receipt-header h1 {
                font-size: 1.5em;
            }

            .paid-stamp {
                font-size: 2.5em;
                padding: 15px 25px;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: #fff;
            }

            body::before {
                display: none;
            }

            .receipt-container {
                border: none;
                box-shadow: none;
            }

            .payment-section,
            .alt-payment {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Receipt -->
    <div class="receipt-container">
        <!-- PAID stamp (shown after payment) -->
        <div class="paid-stamp" id="paid-stamp">PAID</div>

        <!-- Header -->
        <div class="receipt-header">
            <h1>STPETEPROS</h1>
            <div class="status">
                ðŸ’³ PAYMENT RECEIPT
            </div>
        </div>

        <!-- Receipt Number -->
        <div class="receipt-number" id="receipt-number">
            LOADING...
        </div>

        <!-- Barcode separator -->
        <div class="barcode-separator"></div>

        <!-- Transaction Details -->
        <div class="transaction-details">
            <h2>INVOICE DETAILS</h2>
            <div class="detail-row">
                <span class="detail-label">Service:</span>
                <span class="detail-value" id="item-name">Loading...</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Professional:</span>
                <span class="detail-value">StPetePros Network</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Date/Time:</span>
                <span class="detail-value" id="timestamp">Loading...</span>
            </div>
            <div class="detail-row total">
                <span class="detail-label">Amount Due:</span>
                <span class="detail-value" id="total-amount">$0.00</span>
            </div>
        </div>

        <!-- Barcode separator -->
        <div class="barcode-separator"></div>

        <!-- Payment Section -->
        <div class="payment-section" id="payment-section">
            <h2>ðŸ’³ PAY NOW</h2>

            <!-- Stripe Payment (if Stripe link provided) -->
            <div class="stripe-container" id="stripe-container" style="display: none;">
                <div class="loading">Loading Stripe checkout...</div>
            </div>

            <!-- Alternative Payment Methods -->
            <div class="alt-payment">
                <h3>Or pay with:</h3>
                <a href="#" class="payment-button venmo" id="venmo-btn" style="display: none;">
                    Pay with Venmo
                </a>
                <a href="#" class="payment-button cashapp" id="cashapp-btn" style="display: none;">
                    Pay with Cash App
                </a>
                <a href="#" class="payment-button paypal" id="paypal-btn" style="display: none;">
                    Pay with PayPal
                </a>
            </div>

            <div class="payment-instructions">
                <p><strong>PAYMENT INSTRUCTIONS:</strong></p>
                <p>1. Click payment method above</p>
                <p>2. Complete payment in app</p>
                <p>3. Return here for receipt</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="receipt-footer">
            <p>STPETEPROS &copy; <span id="current-year">2026</span></p>
            <p>THANK YOU FOR YOUR BUSINESS</p>
            <p style="font-size: 0.7em; margin-top: 10px;">
                TXN: <span id="txn-id">GENERATING...</span>
            </p>
        </div>
    </div>

    <script>
        // Parse URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                amount: params.get('amount') || '25.00',
                item: params.get('item') || 'Professional Service',
                professional: params.get('professional') || null,
                stripe: params.get('stripe') || null,  // Stripe Payment Link ID
                venmo: params.get('venmo') || null,
                cashapp: params.get('cashapp') || null,
                paypal: params.get('paypal') || null,
                paid: params.get('paid') === 'true'  // Payment confirmation
            };
        }

        // Generate transaction ID
        function generateTxnId() {
            const timestamp = Date.now().toString(36).toUpperCase();
            const random = Math.random().toString(36).substr(2, 5).toUpperCase();
            return `UPC-${timestamp}-${random}`;
        }

        // Initialize page
        function initPaymentPage() {
            const params = getUrlParams();
            const txnId = generateTxnId();

            // Set transaction ID
            document.getElementById('txn-id').textContent = txnId;
            document.getElementById('receipt-number').textContent = txnId;

            // Set item and amount
            document.getElementById('item-name').textContent = decodeURIComponent(params.item);
            document.getElementById('total-amount').textContent = `$${parseFloat(params.amount).toFixed(2)}`;

            // Set timestamp
            const now = new Date();
            document.getElementById('timestamp').textContent = now.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            // Set year
            document.getElementById('current-year').textContent = now.getFullYear();

            // If already paid, show stamp and hide payment section
            if (params.paid) {
                document.getElementById('paid-stamp').classList.add('show');
                document.getElementById('payment-section').style.display = 'none';
                return;
            }

            // Setup Stripe if provided
            if (params.stripe) {
                setupStripePayment(params.stripe, params.amount);
            }

            // Setup alternative payment methods
            if (params.venmo) {
                setupVenmoPayment(params.venmo, params.amount, params.item);
            }

            if (params.cashapp) {
                setupCashAppPayment(params.cashapp, params.amount);
            }

            if (params.paypal) {
                setupPayPalPayment(params.paypal, params.amount);
            }
        }

        // Setup Stripe Payment Link iframe
        function setupStripePayment(stripeLinkId, amount) {
            const container = document.getElementById('stripe-container');
            container.style.display = 'block';

            // Build Stripe Payment Link URL
            // Format: https://buy.stripe.com/test_xxxxx or full URL
            let stripeUrl = stripeLinkId;
            if (!stripeLinkId.startsWith('http')) {
                stripeUrl = `https://buy.stripe.com/${stripeLinkId}`;
            }

            // Add success redirect back to this page with paid=true
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('paid', 'true');
            const successUrl = encodeURIComponent(currentUrl.toString());

            // Some Stripe Payment Links support ?prefilled_promo_code or client_reference_id
            // For full customization, you'd need Stripe Checkout Session
            stripeUrl += `?client_reference_id=${document.getElementById('txn-id').textContent}`;

            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.src = stripeUrl;
            iframe.style.width = '100%';
            iframe.style.minHeight = '500px';
            iframe.style.border = 'none';

            container.innerHTML = '';
            container.appendChild(iframe);
        }

        // Setup Venmo payment
        function setupVenmoPayment(venmoTag, amount, description) {
            const btn = document.getElementById('venmo-btn');
            btn.style.display = 'block';

            const tag = venmoTag.startsWith('@') ? venmoTag : `@${venmoTag}`;
            const note = encodeURIComponent(description);
            const venmoUrl = `venmo://pay?recipients=${tag}&amount=${amount}&note=${note}`;

            btn.href = venmoUrl;
        }

        // Setup Cash App payment
        function setupCashAppPayment(cashtag, amount) {
            const btn = document.getElementById('cashapp-btn');
            btn.style.display = 'block';

            const tag = cashtag.startsWith('$') ? cashtag : `$${cashtag}`;
            const cashappUrl = `https://cash.app/${tag}/${amount}`;

            btn.href = cashappUrl;
        }

        // Setup PayPal payment
        function setupPayPalPayment(paypalUsername, amount) {
            const btn = document.getElementById('paypal-btn');
            btn.style.display = 'block';

            const paypalUrl = `https://paypal.me/${paypalUsername}/${amount}`;

            btn.href = paypalUrl;
        }

        // Save payment to localStorage for tracking
        function savePayment() {
            const params = getUrlParams();
            const payment = {
                txnId: document.getElementById('txn-id').textContent,
                amount: params.amount,
                item: params.item,
                timestamp: new Date().toISOString(),
                status: params.paid ? 'paid' : 'pending'
            };

            const payments = JSON.parse(localStorage.getItem('bodega_payments') || '[]');
            payments.push(payment);
            localStorage.setItem('bodega_payments', JSON.stringify(payments));
        }

        // Initialize on load
        initPaymentPage();
        savePayment();

        // Listen for payment completion (if using Stripe Elements - not Payment Links)
        window.addEventListener('message', (event) => {
            if (event.data.type === 'stripe_payment_complete') {
                // Show paid stamp
                document.getElementById('paid-stamp').classList.add('show');
                document.getElementById('payment-section').style.display = 'none';

                // Update localStorage
                savePayment();

                // Update URL to show paid
                const url = new URL(window.location.href);
                url.searchParams.set('paid', 'true');
                window.history.replaceState({}, '', url);
            }
        });

        // Auto-print if paid=true and fresh visit
        if (getUrlParams().paid && !sessionStorage.getItem('receipt_shown')) {
            sessionStorage.setItem('receipt_shown', 'true');
            setTimeout(() => {
                if (confirm('Payment complete! Print receipt?')) {
                    window.print();
                }
            }, 500);
        }
    </script>
</body>
</html>
